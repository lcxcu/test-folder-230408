1. 继续建立**分析师的共识基准预测**模型 批量数据预处理已完成，还差一个根据日期进行差分运算结尾。
2. 完善自科申请书语言上的内容细节，明天可能会完成整体修改。

```python
import pandas as pd
# anneps
df = pd.read_csv('/mnt/ibes_eps_all_period_csv.csv',usecols=['TICKER','CUSIP','ANALYS','VALUE','FPEDATS','REVDATS']
                 ,dtype = {'FPEDATS':str}, low_memory=False)
grouped_df = df.groupby("TICKER").apply(lambda x: [x.index.min(), x.index.max()]).reset_index()
grouped_dict = grouped_df.set_index("TICKER").to_dict() 
print(grouped_dict[0][df['TICKER'].iloc[-1]])
## 计算每个季度分析师最新预测值中的中位数
grouped = df.groupby(['TICKER', 'FPEDATS', 'ANALYS'])
df['new_value'] = grouped['REVDATS'].transform(lambda x: df.loc[x.idxmax(), 'VALUE'])
df_grouped = df.groupby(['TICKER', 'FPEDATS'])
df['mid_value'] = df_grouped['new_value'].transform('median')
df_anncon_eps = df[['TICKER', 'FPEDATS','CUSIP','mid_value']].drop_duplicates()
df_anncon_eps['FPEDATS'] = pd.to_datetime(df_anncon_eps['FPEDATS'], format='%Y%m%d') 
# 根据FPEDATS（预测截止日期）推测预测年份及季度
df_anncon_eps['fyearq'] = df_anncon_eps['FPEDATS'].dt.year
df_anncon_eps['month'] = df_anncon_eps['FPEDATS'].dt.month
import numpy as np
def quarter_of_month(month):
    return np.ceil(month/3)

df_anncon_eps['quarter'] = df_anncon_eps['month'].apply(quarter_of_month)
def type_int(df,col):
    df[col] = df[col].fillna(0)
    df[col] = df[col].astype(int) 
    return df
df_anncon_eps = type_int(df_anncon_eps,'quarter')
df_anncon_eps = type_int(df_anncon_eps,'month')
df_anncon_eps = type_int(df_anncon_eps,'fyearq')
df_anncon_eps = df_anncon_eps.dropna()

df_anncon_eps.to_csv('all_period_analyst_eps/anncon_eps24.gz', compression='gzip', index=False)
```