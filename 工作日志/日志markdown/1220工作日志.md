1. **midasml包**学习
主要学习了其中`market_ret`,`midas.ardl`,`mixed_freq_data_single`,` monthBegin`,`monthEnd`, `reg.panel.sgl`,`reg.sgl`,`rgdb_date`,`rgdb_vintages`,`sgfit`,`thetafit`,`tscv.sglfit`,`us_rgdp`

其中包括几个重要函数：
- **midas.ardl** 进行ARDL-MIDAS模型的回归
	- 使用单个协变量拟合MIDAS。可选择线性参数多项式如Legendre或非线性多项式（如指数阿尔蒙）。非线性多项式的优化路线通过分析梯度建立，可实现快速且精准的优化。
- **reg.panel.agl** 拟合(panel)面板数据的sg-LASSO回归模型
- **reg.sgl** 拟合sg-LASSO回归模型
	- 相比上一个函数少了nf与method参数的设置
	- 基于优化参数选择method_choice拟合sg-LASSO回归模型。
- **sglfit** 拟合sg-LASSO回归模型。拟合sg-LASSO回归模型的序列的$\lambda$优化参数和固定的$\gamma$优化参数。
- **thetafit**  逐节点进行LASSO回归得到精度矩阵$Θ$
- **tscv.sglfit** 以时间序列k-fold交叉验证拟合sg-LASSO回归模型
	- 运行K次sglfit 函数;首先得到$\lambda$序列中的路径结果，然后计算与每个测试观测值$k \in K$的拟合，计算flods上的平均误差和标准差，并返回lam的最优回归系数lam.min和lam.lse。结果用于计算固定值$\gamma$

---
2. 简单改写了一下代码

``` R
library(midasr)# 导入midasr包

path_data <- "company_wk000001"

datax <- read.csv(paste("G:\\Data\\",path_data,".csv",sep = ""),sep=',' , encoding='UTF-8')
# （1）高频变量数据处理
# company1_x选择 高频变量：涨跌幅x1g
xg<- datax$涨跌幅
zg<- na.omit(datax$周涨幅)# 去空值 
# 提取2018年1月到2022年9月的数据做拟合 
nx <- xg[1:1596]
nz <- zg[1:228]

# (2)提取历史财报数据
datay <- read.csv("G:\\data_all.csv")

code <- '1'
df <- data.frame(
  code = c(code)
)
library("readr")
write_csv(df,"G:\\consequence\\forecast.csv",col_names = TRUE,append = TRUE )


company_y <- subset(datay,证券代码==code,select=c('调前财报.统计日期.'))
company_y <- na.omit(company_y$调前财报.统计日期.)#去空值
ny <-ts(company_y,frequency = 4,start = c(2015,12))
ny<-diff(ny)


#（3）数据取2018年1月1日至2020年12月31日（三年），做训练集
xx <- nx[1:1008]
yy <- ny[1:12]
zz <- nz[1:144]

# (4) 模型拟合
eq_r <- midas_r(yy ~ mls(yy, 1:3, m = 1) + mls(xx, 84:251, 84, nbeta) + mls(zz ,12:35,12,nbeta) , start = list(xx= c(1.7, 1,5),zz= c(1.7, 1,5)))
write.csv( eq_r ,"G:\\consequence\\forecast.csv")
# 样本外均方误差
fulldata <- list(xx = nx , yy = ny[1:length(ny)] ,zz = nz)
insample <- 1:length(yy)
outsample <- (1:length(fulldata$yy))[-insample]
avgf <- average_forecast(list(eq_r), data = fulldata, insample = insample, outsample = outsample)
mse_out <- data.frame(sqrt(avgf$accuracy$individual$MSE.out.of.sample))
write_csv(mse_out,"G:\\consequence\\forecast.csv",append = TRUE )

# (5)模型预测
xn <-nx[1:1596] 
zn <-nz[1:228]
## 新的trendn值
## 结合历史数据和新的高频数据的动态预测
fore<- forecast(eq_r, list(xx = xn,zz = zn), method = "dynamic")  

fore <- data.frame(fore)
write_csv(fore,"G:\\consequence\\forecast.csv",col_names = TRUE,append = TRUE )
fore
```