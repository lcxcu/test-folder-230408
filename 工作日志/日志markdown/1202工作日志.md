在使用R将数据转成时间序列时遇到了问题，发现是先前python处理数据的时候时间不完整，导致有部分财报数据丢失。
改写代码的过程中还进行了公司数据的合并，先共收集5206家公司财报与股票数据，时间从2017年
11月29日至2022年11月28日。

代码如下：
```python
import pandas as pd
import warnings
warnings.filterwarnings('ignore') # 忽略警告

# 读取 股票 证券代码|交易时间|涨跌幅

xlsx_src = ["日个股回报率文件225335089/TRD_Dalyr"+str(i)+".xlsx" 
            for i in range(1,6)]

data_stocks = [pd.DataFrame() for i in range(0,5)]
for i in range(0,5):
    data_stocks[i] = pd.read_excel(xlsx_src[i],
                           header=0,skiprows=[0,2],usecols="A,B,D",
                           dtype={'证券代码':str})

data_stock = pd.concat(data_stocks)
data_stock  = data_stock.rename(columns={'交易日期':'日期',
                                   '涨跌幅':'股票涨跌幅'}) 

# 读取 财报 证券代码|报告类型|报告公布日期|调整前每股收益|调整后每股收益
data_ea = pd.read_excel("年、中、季报基本情况文件011833799/IAR_Rept.xlsx",
                        header=0,skiprows=[0,2],usecols="A,D,E,F,G",
                        dtype={'证券代码':str})

data_ea1  = data_ea.rename(columns={'报告公布日期':'日期',
                                   '调整前每股收益':'调前财报(发布日期)',
                                   '调整后每股收益':'调后财报(发布日期)'}) 

data_ea2  = data_ea.rename(columns={'统计截止日期':'日期',
                                   '调整前每股收益':'调前财报(统计日期)',
                                   '调整后每股收益':'调后财报(统计日期)'})

# pd.date_range('2017-11-29','2022-11-28')
code = list(set(data_stock['证券代码']))
date = list(pd.date_range('2017-11-29','2022-11-28').strftime('%Y-%m-%d'))
dict_data = { '证券代码': [c for c in code for d in date],
              '日期': date*len(code)}
data = pd.DataFrame(dict_data)        
# 创建表格 存有数据 证券代码|时间（交易时间）|股票-涨跌幅|财报-调前收益|财报-调后收益|可见性(可见时调整为对应季度财报数据)
data_all = pd.merge(data, data_stock,on = ['证券代码','日期']
                ,how = 'left')
data_all = pd.merge(data_all, data_ea1[['证券代码','日期','调前财报(发布日期)','调后财报(发布日期)']],on = ['证券代码','日期']
                ,how = 'left')
data_all = pd.merge(data_all, data_ea2[['证券代码','日期','调前财报(统计日期)','调后财报(统计日期)']],on = ['证券代码','日期']
                ,how = 'left')
data_all = data_all.set_index(['证券代码'])

data_all.to_csv('G:\data_all.csv', index=False)

```

使用R语言进行数据处理步骤：
目前在进行数据处理，是将数据转换为时间序列时发现数据问题，所以才改写得上面的代码
![[理解与总结#步骤]]