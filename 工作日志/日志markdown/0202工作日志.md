1. 计算了所需预测变量中的存货、应收账款、毛利率、销售、一般和行政管理费用(SG&A)的数据，并导出了所需的数据表格。
2. 大部分时间花在变量资本支出的计算上，该变量的计算需要知道公司对应行业及该时间对应行业总资本支出。
基于compustat数据集的公司进行行业分类参考以下链接，基于数据集给出的公司四位数SIC代码进行行业分类：
[Kenneth R. French - Detail () 10 Industry Portfolios](http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_10_ind_port.html)
各行业对应时间资本支出表从网上获取，取该表中各行业**每月平均价值加权收益**，按季度求和，求得每季度各行业的资本支出。


代码如下：
```python
# k=3
k = 3
var1 = 'SIC'.lower() # 行业
var2 = 'CAPXY'.lower()
new_var = 'capital_expenditures'
import pandas as pd
# 读入compustat文件
df_compu = pd.read_csv("compustat/compustat_csv/compustat_csv.csv"
                       ,usecols=['gvkey','datadate','fyearq','fyr','fqtr','cusip',var1,var2],nrows = 10,dtype={var1:str},low_memory=False)
                       import pandas as pd
# 读入IPortfolios文件
df_IPortfolios = pd.read_csv("10_Industry_Portfolios_CSV/10_Industry_Portfolios.CSV"
                      , skiprows=11,2330,low_memory=False)
df_IPortfolios = df_IPortfolios.rename(columns={'Unnamed: 0':'Datadate'})
df_IPortfolios = df_IPortfolios.iloc[0:1157,:] # 只取月度投资组合收益
# 读取其中行业分类
industry = list(df_IPortfolios.columns)[1:-1]
import numpy as np
scope = ["0100-0999\n2000-2399\n2700-2749\n2770-2799\n3100-3199\n3940-3989",
        " 2500-2519\n2590-2599\n3630-3659\n3710-3711\n3714-3714\n3716-3716\n3750-3751\n3792-3792\n3900-3939\n3990-3999",
        "2520-2589\n2600-2699\n2750-2769\n2800-2829\n2840-2899\n3000-3099\n3200-3569\n3580-3621\n3623-3629\n3700-3709\n3712-3713\n3715-3715\n3717-3749\n3752-3791\n3793-3799\n3860-3899",
        "1200-1399\n2900-2999",
        "3570-3579\n3622-3622\n3660-3692\n3694-3699\n3810-3839\n7370-7372\n7373-7373\n7374-7374\n7375-7375\n7376-7376\n7377-7377\n7378-7378\n7379-7379\n7391-7391\n8730-8734",
        "4800-4899",
        "5000-5999\n7200-7299\n7600-7699",
        "2830-2839\n3693-3693\n3840-3859\n8000-8099", 
        "4900-4949"]

def convert_ranges(ranges_string):
    ranges = ranges_string.strip().split("\n")
    result = []
    for r in ranges:
        start, end = r.strip().split("-")
        result.append(range(int(start),int(end)))
    return result

range_list = list(map(lambda x: convert_ranges(x), scope)) # 对应SIC生成的range范围range_list 
industry_dict = dict(zip(industry, range_list))# 将对应行业与range_list的中的范围对应起来
def in_ranges(num, ranges): # 判断该代码是否在对应范围中
    num = int(num)
    for r in ranges:
        if num in r:
            return True
    return False
def map_industry(code,industry_dict): # 返回对应行业
    for k in industry_dict:
        if in_ranges(code,industry_dict[k]):
            return k
df_compu['industry'] = df_compu['sic'].apply(lambda x : map_industry(x,industry_dict))
df_compu['industry'] = df_compu['industry'].fillna('nan')
import warnings
warnings.filterwarnings('ignore') # 忽略警告
df_IPortfolios['fyearq'] = df_IPortfolios['Datadate'].str[:4].astype(int)
df_IPortfolios['month'] = df_IPortfolios['Datadate'].str[4:].astype(int)

def quarter_of_month(month):
    if month in [1, 2, 3]:
        return 1
    elif month in [4, 5, 6]:
        return 2
    elif month in [7, 8, 9]:
        return 3
    else:
        return 4

df_IPortfolios['fqtr'] = df_IPortfolios['month'].apply(quarter_of_month)
df_IPortfolios = df_IPortfolios.drop(columns = 'fqrt')
```

