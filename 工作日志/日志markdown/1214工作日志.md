1. **模型预测研究**
>使用对目标值y取差分后，相比以前的其他模型（对y取对数差分或不做处理的模型）样本外均方误差大大减小，均方误差的平方为`1.182238`
>另外，对y取对数差分时模型的优化函数使用受到了警告(`warning`)，只取差分则不会有这些问题

*尽管其中存在问题就是预测只能预测一个值，再往后的值为NA,这个问题没有得到解决，但并不影响模型使用*

以下是模型拟合过程
### 对y求差分

```R
# 1 数据导入
library(midasr)# 导入midasr包
datax <- read.csv("G:\\Data\\company00001.csv",sep=',' , encoding='UTF-8')
#  挑出数据中以 证券代码为1 的公司为例拟合模型
# （1）高频变量数据处理
# company1_x选择 高频变量：涨跌幅x1g
x1g<- datax$股票涨跌幅
# time <-datax$日期
# 提取2018年1月到2022年9月的数据做拟合 
nx1 <- x1g[28:1624]

datay <- read.csv("G:\\data_all.csv")
company1_y <- subset(datay,证券代码=='1',select=c('调前财报.统计日期.'))
company1_y <- na.omit(company1_y$调前财报.统计日期.)# 去空值
ny1 <-ts(company1_y,frequency = 4,start = c(2015,12))
ny1<-diff((ny1))
```

```R
xx <- nx1[29:1036]
yy <- ny1[1:12]
trend <- c(1:length(yy))
```

```R
mwlr1 <- midas_r_ic_table(yy ~ trend + mls(yy, 1 ,m = 1) + mls(xx,84:167, 84 ,nealmon),
						 table=list(xx=list(
						 weights=as.list(c("nealmon", 
						 "nealmon","nbeta")),
						 lags=list(84:251,84:335,84:419),
						 starts=list(c(1, -0.5),c(2, 0.5, -0.1),c(1.7, 1,5)))))
```

```R
mod1_r <- modsel(mwlr1, IC = "AIC", type = "restricted")
```

```R
 Selected model with AIC  =  19.82523 
 Based on restricted MIDAS regression model
 The p-value for the null hypothesis of the test hAh_test is NA 

MIDAS regression model with "NULL" data:
Start = , End = 

 Formula yy ~ trend + mls(yy, 1, m = 1) + mls(xx, 84:335, 84, nealmon) 

 Parameters:
             Estimate Std. Error t value Pr(>|t|)
(Intercept)  -0.72830    0.81935  -0.889    0.468
trend         0.06422    0.09862   0.651    0.582
yy           -0.55181    0.52899  -1.043    0.406
xx1         -45.62657   36.74361  -1.242    0.340
xx2          21.34506  158.98775   0.134    0.905
xx3          -1.41860   10.54505  -0.135    0.905

 Residual standard error: 0.6965 on 2 degrees of freedom
```

```R
eq_r <- midas_r( yy ~ trend + mls(yy, 1, m = 1) + mls(xx, 84:335, 84, nealmon) , start = list(xx = c(2, 0.5, -0.1)))  
```

```R
fulldata <- list(xx = nx1[1:1596] , yy = ny1[1:length(ny1)] ,trend = c(1:length(ny1)-1) )
insample <- 1:length(yy)
outsample <- (1:length(fulldata$yy))[-insample]
avgf <- average_forecast(list(eq_r), data = fulldata, insample = insample, outsample = outsample)
sqrt(avgf$accuracy$individual$MSE.out.of.sample) 
```
样本外均方误差的平方：
```R
[1] 1.182238
```

模型：
```R
> eq_r

MIDAS regression model with "numeric" data:
Start = 4, End = 12
 model: yy ~ trend + mls(yy, 1, m = 1) + mls(xx, 84:335, 84, nealmon) 
(Intercept)       trend          yy         xx1 
   -0.42992     0.03364    -0.53973   -44.23613 
        xx2         xx3 
   38.45909    -2.54799 

Function optim was used for fitting
```

```R
## 预测期
h <- 3
##Declining unemployment  
xn <-nx1[(1596-28*3*4+1):(1596-28*3*1)] 
## 新的trendn值
trendn <- length(ny1)-3 + 1:h
## 结合历史数据和新的高频数据的静态预测  
forecast(eq_r, list(trend = trendn, xx = xn), method = "static")  
```

```R
  Point Forecast
1      0.8086427
2             NA
3             NA
```

```R
## 打印、汇总和绘图
fmr <- forecast(eq_r, list(trend = trendn, xx = xn), method = "static")  
summary(fmr)  
plot(fmr)
```

```R
Forecast method: MIDAS regression forecast (static)

Model Information:

MIDAS regression model with "numeric" data:
Start = 4, End = 12
 model: yy ~ trend + mls(yy, 1, m = 1) + mls(xx, 84:335, 84, nealmon) 
(Intercept)       trend          yy         xx1 
   -0.42992     0.03364    -0.53973   -44.23613 
        xx2         xx3 
   38.45909    -2.54799 

Function optim was used for fitting

Error measures:
                        ME      RMSE       MAE
Training set -1.278245e-05 0.3432495 0.3201038
                  MPE     MAPE     MASE
Training set 29.60025 79.74233 0.652451

Forecasts:
  Point Forecast
1      0.8086427
2             NA
3             NA
```
![[Rplot.png]]

**技术上还存在的问题是：模型上是哪里有问题导致没法实现提前两步预测？（或者说是哪里有问题导致只能提前一步预测）**

2. **R中的t检验**

>t检验是统计学中一种用于比较两组数据的平均值是否有显著差异的检验方法。它通常用于当样本数量较小，不能进行正态性检验时。
>
>t检验可以计算出两组数据之间的差异程度，并根据这个差异程度与数据的可信度来判断两组数据是否有显著差异。如果两组数据的平均值之间的差异程度大于预定的显著性水平，那么就可以说这两组数据之间存在显著差异。

[R语言基础—t检验 - 知乎](https://zhuanlan.zhihu.com/p/369236712#:~:text=t%E6%A3%80%E9%AA%8C%E5%9C%A8%E6%88%91%E4%BB%AC%E7%9A%84%E5%B9%B3%E6%97%A5%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B8%AD%E7%94%A8%E7%9A%84%E9%9D%9E%E5%B8%B8%E7%9A%84%E5%A4%9A%EF%BC%8C%E5%85%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E5%89%8D%E6%8F%90%E6%98%AF%E6%95%B0%E6%8D%AE%E6%BB%A1%E8%B6%B3%EF%BC%9A%E2%80%9C%E7%8B%AC%E7%AB%8B%E2%80%9D%E3%80%81%E2%80%9C%E6%AD%A3%E6%80%81%E2%80%9D%E3%80%81%E2%80%9C%E6%96%B9%E5%B7%AE%E9%BD%90%E2%80%9D%E3%80%82%20%E5%85%B3%E4%BA%8E%E6%95%B0%E6%8D%AE%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%A3%80%E9%AA%8C%EF%BC%8C%E5%90%8E%E6%9C%9F%E4%B8%BA%E5%A4%A7%E5%AE%B6%E4%BB%8B%E7%BB%8D%EF%BC%8C%E4%BB%8A%E5%A4%A9%E4%B8%BA%E5%A4%A7%E5%AE%B6%E4%BB%8B%E7%BB%8Dt%E6%A3%80%E9%AA%8C%E5%9C%A8R%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82,%E5%8D%95%E6%A0%B7%E6%9C%AC%E8%B5%84%E6%96%99%E7%9A%84t%E6%A3%80%E9%AA%8C%E5%AE%9E%E9%99%85%E6%98%AF%E5%88%A4%E6%96%AD%E6%A0%B7%E6%9C%AC%E7%9A%84%E6%80%BB%E4%BD%93%E5%9D%87%E6%95%B0%E5%92%8C%E6%9F%90%E4%B8%80%E5%B7%B2%E7%9F%A5%E7%9A%84%E6%80%BB%E4%BD%93%E5%9D%87%E6%95%B0%E6%9C%89%E6%97%A0%E5%B7%AE%E5%88%AB%E3%80%82%20%E5%9C%A8R%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%8D%95%E6%A0%B7%E6%9C%AC%E8%B5%84%E6%96%99%E7%9A%84t%E6%A3%80%E9%AA%8C%E5%87%BD%E6%95%B0%E4%B8%BAt.test%20%28%29%2C%E5%85%B6%E5%8F%82%E6%95%B0%E5%A6%82%E4%B8%8B%EF%BC%9A)

似乎要用到其中的**单样本资料** 与 **配对资料的t检验**
